<!DOCTYPE html>
<html>
<head>
<title>Slot Machine</title>
<style>
body {
	margin: 0;
	border: 0;
}
</style>
</head>
<body>
<canvas id="canvas"></canvas>
<center><button onclick="onRoll()"><h1>--ROLL--</h1></button></center>
<center><h1>Auto roll:</h1></center>
<center><input type="checkbox" id="autoroll" style="width: 50px; height: 50px;"></input></center>
<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

function resizeCanvas(){
	canvas.width = window.innerWidth;
	canvas.height = window.innerWidth/5;
}resizeCanvas();
window.addEventListener("resize",resizeCanvas);

const autoRoll = document.getElementById("autoroll");

const rollSound = new Audio("roll.mp3");
rollSound.volume = 0.4;

const jackpotSound = new Audio("jackpot.mp3");
jackpotSound.volume = 1;

const tucadonka = new Audio("tucadonka.mp3");
tucadonka.volume = 0.75;

var rolling = false;
var rollStart = 0;
const ROLLS = ["red","blue","green","gray"];
var roll = [0,0,0,0,0];

function onRoll(){
	if(!rolling){
		rollSound.play();
		rolling = true;
		var d = new Date();
		rollstart = d.getTime();
	}
}

function randomiseRoll(){
	for(i = 0; i < roll.length; i++){
		roll[i] = Math.floor(Math.random() * (ROLLS.length-1));
	}
}

function checkJackpot(){
	var first = roll[0];
	for(i = 1; i < roll.length; i++){
		if(roll[i] != first){
			return false
		}
	}
	return true
}

window.setInterval(()=>{
	ctx.clearRect(0,0,canvas.width,canvas.height)
	if(rolling){
		var d = new Date();
		if(d.getTime()-rollstart > 1000){
			rolling=false;
			if(checkJackpot()){
				jackpotSound.play();
				tucadonka.play();
				alert("!!JACKPOT!!\nNEVER STOP GAMBLING!");
			}
			else if(autoRoll.checked){
				rolling = true;
				rollstart = d.getTime();
				rollSound.play();
			}
		}else{
			randomiseRoll();
		}
	}
	for(i = 0; i < roll.length; i++){
		ctx.fillStyle = "black";
		ctx.fillRect(i*(canvas.width/5),0,canvas.width/5,canvas.height);
		ctx.fillStyle = ROLLS[roll[i]];
		ctx.fillRect(i*(canvas.width/5)+2,2,canvas.width/5-4,canvas.height-4);
	}
},1000/10)
</script>
</body>
</html>